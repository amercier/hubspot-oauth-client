!function(){"use strict";function t(){var t,n,i=arguments[0];for(n=1;n<arguments.length;n++)for(t in arguments[n])arguments[n].hasOwnProperty(t)&&(i[t]=arguments[n][t]);return i}function n(t){return Object.prototype.toString.apply(t)}function i(t){return"number"==typeof t&&!isNaN(t)}function e(t){return"string"==typeof t}function o(t){return s.encodeURIComponent(t).replace(/[!'()*]/g,function(t){return"%"+t.charCodeAt(0).toString(16)})}function r(n){this.config=t({},this.constructor.DEFAULT_CONFIG,n),this.constructor.validateConfiguration(this.config),this.callbacks={oAuthSuccess:[],oAuthError:[]}}var u,c,s=window;r.UUID_REGEXP=/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/,r.SCOPES={},r.SCOPES.OFFLINE="offline",r.SCOPES.CONTACTS_READ_ONLY="contacts-ro",r.SCOPES.CONTACTS_READ_WRITE="contacts-rw",r.SCOPES.BLOG_READ_WRITE="blog-rw",r.SCOPES.EVENTS_READ_WRITE="events-rw",r.SCOPES.KEYWORD_READ_WRITE="keyword-rw",c=[r.SCOPES.OFFLINE,r.SCOPES.CONTACTS_READ_ONLY,r.SCOPES.CONTACTS_READ_WRITE,r.SCOPES.BLOG_READ_WRITE,r.SCOPES.EVENTS_READ_WRITE,r.SCOPES.KEYWORD_READ_WRITE],r.DEFAULT_CONFIG={integrationURI:"https://app.hubspot.com/auth/authenticate",windowWidth:600,windowHeight:400,cancelCheckDelay:100},r.CONFIG_VALIDATORS={integrationURI:e,clientId:function(t){return r.UUID_REGEXP.test(t)},applicationScope:function(t){return"[object Array]"===n(t)&&t.length>0&&t.every(function(t){return-1!==c.indexOf(t)})},redirectURI:e,windowHeight:function(t){return i(t)},windowWidth:function(t){return i(t)},cancelCheckDelay:function(t){return i(t)}},r.validateConfiguration=function(t){Object.keys(t).forEach(function(t){if(!(t in r.CONFIG_VALIDATORS))throw new Error('Unknown config parameter "'+t+'"')}),Object.keys(r.CONFIG_VALIDATORS).forEach(function(n){if(!(n in t))throw new Error('Missing parameter "'+n+'" from config');var i=t[n];if(!r.CONFIG_VALIDATORS[n](i))throw new Error('Parameter "'+n+'" in config is invalid: "'+i+'"')})},r.isHubIdValid=function(t){var n=Number(t);return!isNaN(n)&&n>0},u=r.prototype,u.isOpen=function(){return this._promiseWindow&&this._promiseWindow.isOpen()},u._setHubId=function(t){if(!this.constructor.isHubIdValid(t))throw new Error('Invalid HubSpot id "'+t+'"');if(this.isOpen())throw new this.constructor.PendingIntegrationError('Cannot set Hub ID to "". A OAuth integration is pending');this.hubId=Number(t)},u._getIntegrationURI=function(){return this.config.integrationURI+"?"+["client_id="+o(this.config.clientId),"portalId="+o(this.hubId),"scope="+o(this.config.applicationScope.join(" ")).replace("%20","+"),"redirect_uri="+o(this.config.redirectURI+(-1===this.config.redirectURI.indexOf("?")?"?":"&")+["hubId="+this.hubId].join("&"))].join("&")},u._getPromiseWindow=function(){return this._promiseWindow||(this._promiseWindow=new PromiseWindow(this._getIntegrationURI(),t({},this._config,{onPostMessage:function(t){"hubId"in t.data&&(t.data.hubId=Number(t.data.hubId)),PromiseWindow.defaultConfig.onPostMessage.call(this,t)}}))),this._promiseWindow},u.initiateIntegration=function(t){if(0===arguments.length)throw new Error("Missing Hub ID");return this._setHubId(t),this._getPromiseWindow().open()},"function"==typeof define&&define.amd?define([],function(){return r}):"object"==typeof exports?module.exports=r:s.HubSpotOAuthClient=r}();